version: '3'
services:
  jup:
    volumes:
      - .:/home/jovyan/work
    environment:
      PYTHONUNBUFFERED: 1
    image: tervo/pystan
    ports:
      - "81:8888"

  tracker:
    volumes:
      - .:/usr/src/app:Z
    environment:
      AWS_ACCESS_KEY_ID: ***REMOVED***
      AWS_SECRET_ACCESS_KEY: ***REMOVED***
    build:
      context: ./tracker
      dockerfile: Dockerfile
    container_name: tracker
    image: sasse:storm_tracker
    #command: python -u tracker/storm_tracker.py --starttime ${StartTime:-2011-03-03T11:00:00} --endtime ${EndTime:-2011-03-03T11:00:00} --smartmet_config_name ${smartmet_config_name:-dev} --db_config_name ${db_config_name:-local}
    #command: python -u tracker/storm_tracker.py --starttime ${StartTime:-2011-07-23T13:00:00} --endtime ${EndTime:-2011-07-23T13:00:00} --smartmet_config_name ${smartmet_config_name:-dev} --db_config_name ${db_config_name:-local}
    #command: python -u tracker/storm_tracker.py --starttime ${StartTime:-2010-07-23T06:00:00} --endtime ${EndTime:-2010-07-23T06:00:00} --smartmet_config_name ${smartmet_config_name:-dev} --db_config_name ${db_config_name:-local}

    command: python -u tracker/storm_tracker.py --starttime ${StartTime:-2011-12-30T21:00:00} --endtime ${EndTime:-2011-12-30T23:00:00} --smartmet_config_name ${smartmet_config_name:-dev} --db_config_name ${db_config_name:-local} --dataset_name ${DatasetName:-classification_dataset_dev} --requests_throttle_time ${requests_throttle_time:-0}


    #command: python -u tracker/storm_tracker.py --starttime 2010-07-23T06:00:00 --endtime 2010-08-10T01:00:00

  create_dataset:
    volumes:
      - .:/usr/src/app:Z
    environment:
      AWS_ACCESS_KEY_ID: ***REMOVED***
      AWS_SECRET_ACCESS_KEY: ***REMOVED***
      CURL_CA_BUNDLE: /etc/pki/tls/certs/ca-bundle.crt
    build:
      context: ./create_dataset
      dockerfile: Dockerfile
    container_name: create_dataset
    image: sasse:create_dataset
    command: python -u create_dataset/create_dataset.py --config_filename ${config_filename:-cnf/rfc.ini} --config_name ${config_name:-test}


  cl:
    volumes:
      - .:/usr/src/app:Z
    environment:
      AWS_ACCESS_KEY_ID: ***REMOVED***
      AWS_SECRET_ACCESS_KEY: ***REMOVED***
    build:
      context: ./classifier
      dockerfile: Dockerfile
    container_name: classifier
    image: sasse:classifier
    command: python -u classifier/train_classifier.py --config_filename ${config_filename:-cnf/rfc.ini} --config_name ${config_name:-test}

  classify:
    volumes:
      - .:/usr/src/app:Z
    environment:
      AWS_ACCESS_KEY_ID: ***REMOVED***
      AWS_SECRET_ACCESS_KEY: ***REMOVED***
    build:
      context: ./classifier
      dockerfile: Dockerfile
    container_name: classifier
    image: sasse:classifier
    command: python -u classifier/classify.py --starttime ${StartTime:-2011-12-30T21:00:00} --endtime ${EndTime:-2011-12-30T23:00:00} --db_config_name ${db_config_name:-local}

  evaluate:
    volumes:
      - .:/usr/src/app:Z
    environment:
      AWS_ACCESS_KEY_ID: ***REMOVED***
      AWS_SECRET_ACCESS_KEY: ***REMOVED***
    build:
      context: ./classifier
      dockerfile: Dockerfile
    container_name: evaluator
    image: sasse:classifier
    command: python -u classifier/evaluate.py --config_filename ${config_filename:-cnf/rfc.ini} --config_name ${config_name:-test}
